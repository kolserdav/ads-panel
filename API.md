## Документация API вызовов

### Вызовы по данным пользователя

`/user GET` - отвечает success если почта доступна для регистрации

`/user POST` - Регистрация пользователя. Обязательные параметры email, first_name, last_name, password, password_repeat, company, skype, При успешной регистрации отправляет письмо с сылкой подтверждения почты

`/user/confirm GET` - Подтверждение почты. Ожидает QueryString e=email и k=key Которые сформированы из ссылки отправленой при регистрации

`/user/login POST` - Апи входа. Ожидает email и password в результате возвращает токен. Который в закрытых узлах ожидается в заголовке xx-auth.

`/user PUT` - Изменение данных пользователя. Меняет такие данные как first_name, last_name, company, skype. при отправке sendConfirm=1 отправляет письмо подтверждения почты. Адрес почты можно сменить только с передачей sendConfirm=1 (также передаём email). Меняет почту на новую, и ставит confirm=0 до подтверждения переходом по ссылке из письма.

`/user/forgot GET` - Запрос токена смены пароля. Ожидает QueryString e=email и k=key Которые сформированы из ссылки отправленой при запросе смены пароля
Внимание с одним key генерация токена смены пароля сработает только один раз, для повторной генерации нового токена нужно передавать полученный токен вместо key. Полученный здесь токен смены пароля работает в смене пароля по PUT /user/pass

`/user/forgot POST` - Запрос на смену пароля. Передаётся почта в email, создается и отправляется ключ, который при переходе на GET /user/forgot проверяет ключ и генерирует токен на смену пароля.

`/user/pass PUT` - Смена пароля. Ожидает заголовок xx-token сформированный через POST /user/forgot - при переходе по ссылке из письма или обновленный, через GET /user/forgot. Также обязательно передаем email, password, password_repeat

`/user/session GET` - Возвращает данные пользователя. Защищен посредником auth.


### Вызовы по данным кампаний

`/campaign POST` - Создание кампании. Обязательные параметры title, link, countries, cost, budget, ip_pattern, white_list, black_list, Необязательные offer_id

`/campaign/:id PUT` - Обновление данных кампании. title, link, postback, countries, cost, budget, ip_pattern, white_list, black_list, offer_id, Можно менять по одному или все

`/campaign/:id GET` - Получение кампании по id. Имеет доступ только создатель и админы. Благодаря посредникам selfCampaign и orAdmin.

`/campaign GET` - Получение кампаний по фильтрам. Имеет доступ только авторизованный, но без посредников selfCampaign и orAdmin, так как нужна непосредственная выборка на роуте. Принимает 3 body аргумента.

@self — - это для админа, если он хочет получить только свои кампании self=1 иначе он видит все кампании.
@current — - текущая страница
@limit — - количество на странице
@status — - сортировка по статусу

### Вызовы по данным офферов

`/offer POST` - Создание нового оффера. Ид пользователя берет из токена при аутентификации вызова. Принимает 'title', 'description'.

`/offer/icon/:id POST` - Изменяет иконку оффера. Ожидает передаваемую иконку в multipart. Название FormData объекта 'icon'.

`/offer/image/:id POST` - Изменяет изображение оффера. Ожидает передаваемое изображение в multipart. Название FormData объекта 'image'.

`/offer PUT` - Изменение Названия и комментария оффера. Принимает title и comment, если передан один из них то меняет только его, если ничего не передано, ничего не меняет. если переданы оба, то меняет оба последовательно.

`/offer/status PUT` - Изменение статуса оффера. Скрыто за посредниками auth, и onlyAdmin

### Вызовы статистики

`/statistic/graph GET` Получает статистику для графика, группировку выполняет в зависимости от временного шаблона, или по времени, или по дням, неделям и т.д.
@self — {1|0} - админ смотрит все или только свои
@time — {Types.Time} - временной шаблон
@customTime — {number} - время в днях если time =

`/statistic/table GET` Возвращает статистику для таблицы, группированную по одному из типов
@limit {number} - количество эелементов на странице
@current {number} - запрашиваемая страница
@group {Types.GroupBy} - по какому полю сгруппировать
@time {Types.Time} - шаблон отсчета времени
@customTime {number?} - количество дней отнять от сегодня
@self {number?} - когда админ запрашивает для себя